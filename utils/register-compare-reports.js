const fs = require('fs');
const ADDRS = [
  '0x4800e3f00f9cdbc4420ce4b299855c39455a7bab',
  '0xc0f35ba14a291a1fdcabb7e7e53a768b5643c719',
];
const REPORTS = [
  '{"id":"27594931944982484559535512292851436992","timestamp":"2019-02-12T18:50:27.368748","isvEnclaveQuoteStatus":"GROUP_OUT_OF_DATE","platformInfoBlob":"1502006504000700000505020401010000000000000000000008000009000000020000000000000AC7E077731D2090E685064D91CD6C1AABDDA629B6BF478D27950D59FCC7E33271333A92D56098E0489FE4339B664ADE4888AA1695B389EC64AFFA2B1D6C1DBECBDD","isvEnclaveQuoteBody":"AgAAAMcKAAAHAAYAAAAAABYB+Vw5ueowf+qruQGtw+6yMPMBSlbDeUQ8w7OHUCgqAgX/BP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAHAAAAAAAAADlca6XQetVGTms5okoNNINkpvtRB41+GLAF+5XJv27MAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACD1xnnferKFHD2uvYqTXdDA8iZ22kCD5xw7h38CMfOngAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAOPwD5zbxEIM5LKZhVw5RVp7qwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"}',
  '{"id":"260397826656906739541036985405245347656","timestamp":"2019-02-22T23:17:34.910210","isvEnclaveQuoteStatus":"GROUP_OUT_OF_DATE","platformInfoBlob":"1502006504000600000808020401010000000000000000000008000009000000020000000000000AF29644456FD980CA26F424C5B1D93B57710F93871B8541A047A68890E67F2843FABF4D0AB32EAEE19BC0D8C70B8C216EAD679AAFD26AE2B199A1AB1CC8E19863BD","isvEnclaveQuoteBody":"AgAAAPIKAAAHAAYAAAAAABYB+Vw5ueowf+qruQGtw+4hV02xVi/G9DKrrutml36oCAgCBAECAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAHAAAAAAAAAHlBwb5DqBBdjr8C7U9aKfOLAAiFz98G7ljtNQMZbw2IAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACD1xnnferKFHD2uvYqTXdDA8iZ22kCD5xw7h38CMfOngAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAweGMwZjM1YmExNGEyOTFhMWZkY2FiYjdlN2U1M2E3NjhiNTY0M2M3MTkAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"}',
];
const SIGNS = [
  '57ebd93c7b0c665ad98551a594ad3d7e3593f9ada7ca7ae4625328be23b615dc57a317a14ba4a79426466b2435fc92a1830ceff9828d535642e9e66c3aeba6537e9d5e25495bf290c487de720691f66de643c3497645c27ad278f68e05799d18050bb03e0c280ddc0c29a581fe088f1403c08932b316b77226c8661c17b334f3e68386dd680485a14806e3bf2a6e46ec0be9c9a6eedc4b6f68f3f3f509dc995333a791e875691f1a4e7345ecb8683994ae56ae242f59414dd5f428e738d6c200358f4be556653d3facdf35d1e681a26755889ba42cc1fba0cb17f00879403c5d5f6a42bf08904e4f0e637cad0a20eebb74ce5630c991ab19e1a1fafb116a79e9',
  '98883a4cb3bdbfe6bd0f555a634831f03929d76d60dab3a96ea8b1c89fbb5e49e4860dcb3ed38e81b2f9b9f88bdc111ccca4d1513faf95f72c69c9e622cb560821669ece22afa0dd12e0fff283b51eabf025c9ea2ea175f91908afebbd3945f695c0ba6fbd2763faf5cb20144b34978ce5bf7c333ba1462e5fd57bd32e6fc3ec0b54b39da4bd189471dbb88947e4a77a911b7bf8b6974db7d5fb8f73a35ef6b162bdc12485e948cc81626d39274cfe8052ba26b24a5e5a6f6780757d46d450b4f18b377347ab8b1bc3d3bc01573a71a0979db95dbf1e89b3cb2ef1c22ba7cb52b6518bed80f5b64d9f7d9cfef4ea523210e15777bccb7006d31bd79689662e9a',
];
module.exports = function(callback) {
  (async () => {
    const jsonFile = 'build/contracts/IEnigma.json';
    const parsed = JSON.parse(fs.readFileSync(jsonFile));
    const abi = parsed.abi;
    const address = '0x31B1232836dB107Aeb8C0612C3607DC7Ce836862';
    let Enigma = new web3.eth.Contract(abi, address);
    const blockNumber = await web3.eth.getBlockNumber();
    console.log('The current block number:', blockNumber);
    const accounts = await web3.eth.getAccounts();
    for (let [index, signer] of ADDRS.entries()) {
      console.log('Registering report for signer', signer, REPORTS[index]);
      // const report = '0x' + RLP.encode(REPORTS[index]).toString('hex');
      const report = '0x' + Array.from(REPORTS[index]).map((c) => c.charCodeAt(0).toString(16)).join('');
      const sig = '0x' + SIGNS[index];
      try {
        const receipt = await Enigma.methods.register(signer, report, sig).send({
          gas: 4712388,
          gasPrice: 100000000000,
          from: accounts[index],
        });
        console.log('The receipt for worker', signer, receipt);
      } catch (e) {
        console.log('Unable to register', e);
      }
    }
    callback();
  })();
};
